// For format details, see https://aka.ms/devcontainer.json. For config options, see the README at:
// https://github.com/microsoft/vscode-dev-containers/tree/v0.194.0/containers/ubuntu
{
    "name": "dev-c7",
    "image": "ghcr.io/dls-controls/dev-c7:latest",
    "remoteEnv": {
        "DISPLAY": "${localEnv:DISPLAY}",
        "HOME": "${localEnv:HOME}",
        "SSH_AUTH_SOCK": "${localEnv:SSH_AUTH_SOCK}"
    },
    // these two lines mount the local workspace folder so that the path is the same inside and outside the container.
    "workspaceMount": "source=${localWorkspaceFolder},target=${localWorkspaceFolder},type=bind,consistency=cached",
    "workspaceFolder": "${localWorkspaceFolder}",
    "remoteUser": "${localEnv:USER}",
    "containerUser": "${localEnv:USER}",
    // Set *default* container specific settings.json values on container create.
    "settings": {},
    // Add the IDs of extensions you want installed when the container is created.
    "extensions": [
        "ms-vscode.cpptools",
        "ms-python.python",
        "ms-python.vscode-pylance",
        "ms-vscode.cmake-tools",
        "streetsidesoftware.code-spell-checker",
        "ryanluker.vscode-coverage-gutters",
        "mhutchie.git-graph",
        "eamodio.gitlens",
        "gruntfuggly.todo-tree",
        "redhat.vscode-yaml",
        "nsd.vscode-epics",
        "alefragnani.bookmarks"
    ],
    // use c7 to get the auto mount folders mounted
    "initializeCommand": [
        "bash",
        "${localWorkspaceFolder}/c7",
        "-m"
    ],
    "mounts": [
        "source=/dls,target=/dls,type=bind,consistency=cached",
        "source=/dls_sw,target=/dls_sw,type=bind,consistency=cached",
        "source=/home,target=/home,type=bind,consistency=cached",
        "source=/scratch/,target=/scratch/,type=bind,consistency=cached",
        "source=/tmp,target=/tmp,type=bind,consistency=cached",
        "source=${localEnv:SSH_AUTH_SOCK},target=${localEnv:SSH_AUTH_SOCK},type=bind,consistency=cached"
    ],
    "runArgs": [
        "--net=host",
        "--security-opt=label=type:container_runtime_t",
        "--userns=keep-id",
        "--annotation=run.oci.keep_original_groups=1",
        "--storage-opt=ignore_chown_errors=true",
        "--runtime=/usr/bin/crun"
    ]
}